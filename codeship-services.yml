db:
    build:
        dockerfile: Dockerfile-pg
        context: .
        args:
            SQL_FILE: multidatabase.sh
    environment:
        - POSTGRES_USER=authentic8
        - POSTGRES_DB=authentic8
        - POSTGRES_PASSWORD=authentic8
        - POSTGRES_MULTIPLE_DATABASES=authentic8_csrfs,authentic8_passreset,authentic8_session

app:
    image: golang:latest
    volumes:
        - ./:/go/src/authentic8/
    working_dir: /go/src/authentic8
    depends_on:
        - db
    environment:
        WAIT_HOSTS: db:5432
        WAIT_BEFORE_HOSTS: 5
    encrypted_env_file:
        - env.encrypted

coverage:
    build:
        dockerfile: Dockerfile
        context: .
    volumes:
        - ./:/go/src/authentic8/
    working_dir: /go/src/authentic8
    encrypted_env_file:
        - env.encrypted
